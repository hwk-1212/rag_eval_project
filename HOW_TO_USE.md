# 📘 RAG评测对比平台 - 使用手册

## 🎯 项目简介

这是一个专业的RAG（检索增强生成）评测与对比平台，让您能够：
- 上传各种格式的文档
- 使用不同的RAG技术进行问答
- 直观对比各RAG方案的效果
- 对答案进行多维度评分
- 查看统计分析和性能对比

## 🏃‍♂️ 第一次使用

### 步骤1: 环境准备

```bash
# 确保Python 3.8+
python3 --version

# 进入项目目录
cd rag_all_app

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 步骤2: 配置服务

编辑 `.env` 文件（如果不存在，复制 `.env.example`）：

```ini
# 必须配置项
LLM_BASE_URL=http://10.10.50.150:8712/v1
LLM_API_KEY=your_llm_api_key
EMBEDDING_BASE_URL=http://10.10.50.150:8998/v1
EMBEDDING_API_KEY=your_embedding_api_key
```

### 步骤3: 启动服务

```bash
# 一键启动（推荐）
./start_all.sh

# 或分别启动
./start_backend.sh   # 终端1
./start_frontend.sh  # 终端2
```

### 步骤4: 访问应用

- **前端界面**: http://localhost:8501
- **API文档**: http://localhost:8000/docs

## 📖 详细使用指南

### 1. 文档管理

#### 上传文档
1. 在左侧面板找到"文档管理"区域
2. 点击"上传文档"按钮
3. 选择文件（支持PDF、TXT、MD、DOCX）
4. 点击"上传并处理"
5. 等待处理完成（会显示成功消息）

**支持的文件类型**:
- `.pdf` - PDF文档
- `.txt` - 纯文本文件
- `.md` - Markdown文件
- `.docx` - Word文档

**文件大小限制**: 100MB

#### 选择文档
- 在"已上传文档"列表中勾选要查询的文档
- 可以看到文档的分块数量
- 点击🗑️按钮可以删除文档

### 2. RAG配置

#### 选择RAG技术
在左侧"RAG配置"区域：
- **Simple RAG**: 基础RAG（当前已实现）
- 可多选，进行技术对比

#### 调整RAG参数
展开"RAG参数"面板：
- **检索数量 (top_k)**: 1-20，推荐5
  - 值越大，检索的文档越多，但可能引入噪音
  - 值越小，更精准但可能遗漏信息
  
- **分块大小**: 100-1000，推荐500
  - 影响文档如何被切分
  - 较大的块保留更多上下文
  
- **重叠大小**: 0-200，推荐100
  - 相邻块之间的重叠字符数
  - 避免重要信息被切断

#### 调整LLM参数
展开"LLM配置"面板：
- **温度 (Temperature)**: 0.0-1.0，推荐0.7
  - 控制生成的随机性
  - 0接近确定性，1更有创造性
  
- **最大Token数**: 500-4000，推荐2000
  - 限制生成答案的长度

### 3. 提问和对话

#### 基本提问
1. 在中间对话窗口的输入框输入问题
2. 按回车或点击发送
3. 稍等片刻，看到答案

**提问技巧**:
- ✅ 具体明确："文档中关于人工智能的定义是什么？"
- ✅ 聚焦主题："介绍一下神经网络的基本原理"
- ❌ 太宽泛："讲讲AI"
- ❌ 无关文档："今天天气怎么样？"

#### 查看答案
- 主答案显示在对话窗口
- 显示使用的RAG技术名称
- 显示执行时间

#### 清空对话
点击"🗑️ 清空对话"按钮重新开始

### 4. 结果对比

#### 查看详细结果
在右侧面板：
- 如果使用了多个RAG技术，会有多个标签页
- 切换标签查看不同技术的结果

#### 每个结果包含
1. **答案文本**: 完整的生成答案
2. **执行时间**: 该RAG技术的运行时间
3. **检索文档**: 展开查看具体检索到的文档片段
   - 相似度分数
   - 文档内容
   - 来源文件名

### 5. 评分

#### 多维度评分
为每个答案评分（0-10分）：
- **准确性**: 答案是否正确
- **相关性**: 是否回答了问题
- **流畅性**: 语言是否通顺
- **完整性**: 信息是否完整
- **总体评分**: 综合评价

#### 添加评价
- 在评分下方的文本框输入评价说明
- 点击"提交评分"保存

### 6. 统计分析

#### 查看统计
滚动到右侧面板底部：
- 表格展示各RAG技术的统计数据
- 图表直观对比性能

#### 统计指标
- **查询数**: 该技术被使用的次数
- **平均执行时间**: 性能指标
- **平均评分**: 质量指标

## 🎨 界面导航

### 左侧面板（文件管理与配置）
```
┌─────────────────────┐
│ 📁 文件管理         │
│  - 上传文档         │
│  - 文档列表         │
│                     │
│ ⚙️ RAG配置          │
│  - 选择RAG技术      │
│  - RAG参数          │
│  - LLM配置          │
└─────────────────────┘
```

### 中间面板（主对话窗口）
```
┌─────────────────────┐
│ 💬 对话窗口         │
│                     │
│ User: 问题          │
│ Assistant: 答案     │
│                     │
│ [输入框____________]│
└─────────────────────┘
```

### 右侧面板（结果对比）
```
┌─────────────────────┐
│ 📊 RAG结果对比      │
│                     │
│ [Simple RAG]        │
│  📝 答案            │
│  🔍 检索文档        │
│  ⭐ 评分            │
│                     │
│ 📈 统计对比         │
└─────────────────────┘
```

## 💡 使用技巧

### 提高答案质量
1. **选择相关文档**: 确保文档内容与问题相关
2. **调整top_k**: 问题复杂时增加检索数量
3. **优化问题**: 使用文档中的专业术语
4. **调整温度**: 需要精确答案时降低温度

### 有效对比
1. **同时运行多个技术**: 选择2-3个RAG技术
2. **使用相同问题**: 确保对比公平
3. **关注不同维度**: 
   - 执行时间（性能）
   - 答案质量（效果）
   - 检索相关性
4. **记录评分**: 多次测试后查看统计

### 文档准备
1. **清晰的格式**: PDF和DOCX格式最佳
2. **合理的大小**: 建议单文件<50MB
3. **结构化内容**: 有标题、段落的文档效果更好
4. **中英文混合**: 系统都支持

## 🔧 故障排除

### 问题1: 上传失败
**症状**: 点击上传后没有反应或报错

**解决**:
```bash
# 检查文件格式
支持: .pdf, .txt, .md, .docx

# 检查文件大小
文件应 < 100MB

# 查看后端日志
tail -f logs/app_*.log
```

### 问题2: 查询没有结果
**症状**: 提问后没有答案或显示错误

**解决**:
```bash
# 1. 确认已选择文档
左侧面板勾选至少一个文档

# 2. 确认文档已处理
查看文档的"块数"是否 > 0

# 3. 检查embedding服务
运行: python test_api.py

# 4. 查看日志
tail -f logs/app_*.log
```

### 问题3: 答案生成慢
**症状**: 等待时间很长

**原因和解决**:
- **文档太大**: 减少top_k或使用较小的文档
- **LLM服务慢**: 检查LLM服务状态
- **网络问题**: 检查到LLM的网络连接

### 问题4: 前后端连接失败
**症状**: 前端显示"连接后端失败"

**解决**:
```bash
# 检查后端是否运行
curl http://localhost:8000/health

# 如果没运行，启动后端
./start_backend.sh

# 检查端口是否被占用
lsof -i :8000
```

## 📊 性能参考

### 处理时间（参考）
- **文档上传**: 1-10秒（取决于大小）
- **文档向量化**: 5-30秒（取决于块数）
- **单次查询**: 3-10秒（取决于top_k和LLM）

### 资源使用（参考）
- **内存**: 2-4GB
- **磁盘**: 依文档数量，每10MB文档约需100MB空间
- **CPU**: 中等负载

## 🚀 高级用法

### 批量测试
```python
# 准备测试问题列表
questions = [
    "什么是人工智能？",
    "神经网络的原理是什么？",
    "深度学习有哪些应用？"
]

# 使用API批量测试
for q in questions:
    # 调用 /api/v1/qa/query
    pass
```

### API集成
查看完整API文档：http://localhost:8000/docs

示例：
```python
import requests

# 上传文档
files = {'file': open('document.pdf', 'rb')}
response = requests.post('http://localhost:8000/api/v1/documents/upload', files=files)

# 查询
payload = {
    "query": "什么是AI？",
    "document_ids": [1],
    "rag_techniques": ["simple_rag"]
}
response = requests.post('http://localhost:8000/api/v1/qa/query', json=payload)
```

## 📞 获取帮助

1. **文档**: 阅读 README.md 和 QUICKSTART.md
2. **测试**: 运行 `python test_api.py` 诊断
3. **日志**: 查看 `logs/` 目录下的日志文件
4. **API**: 访问 http://localhost:8000/docs 查看API文档

## 🎓 最佳实践

### DO ✅
- 使用高质量、结构化的文档
- 针对文档内容提出具体问题
- 对比多个RAG技术的效果
- 记录评分以建立数据集
- 定期清理不需要的文档

### DON'T ❌
- 上传超大文件（>100MB）
- 提出与文档完全无关的问题
- 期望超出文档内容的答案
- 忽略检索到的文档片段
- 在不同配置间直接对比评分

---

**祝您使用愉快！探索RAG技术的魅力！** 🎉

