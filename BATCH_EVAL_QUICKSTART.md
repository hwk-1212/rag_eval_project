# 🚀 批量自动评估快速上手

## 5分钟体验批量评估功能

### 前提条件
- ✅ 后端和前端已启动
- ✅ 已上传至少1个文档

---

## 步骤1: 选择RAG技术（左侧栏）

在侧边栏的"⚙️ RAG配置"中，选择要对比的技术（建议选3-5个）：

```
☑️ Simple RAG (基础)
☑️ Reranker RAG (重排序)
☑️ Fusion RAG (混合检索)
☑️ HyDE RAG (假设文档)
☑️ Query Transformation (查询转换)
```

---

## 步骤2: 配置评估选项（左侧栏）

在"🤖 自动评估配置"中：

```
☑️ 查询后自动评估         # 开启自动评估
☑️ 使用Ragas评估           # 开启标准化评估（可选）

📊 评估维度
• LLM评分: 相关性、忠实度、连贯性、流畅度、简洁性
• Ragas: Faithfulness、Answer Relevancy、Context Precision/Recall
```

**提示**: 
- 不勾选Ragas：评估更快（~2-3秒/RAG）
- 勾选Ragas：更标准但更慢（~8-10秒/RAG）

---

## 步骤3: 提出问题（中间对话窗口）

输入一个问题，例如：

```
什么是RAG技术？它有哪些优势？
```

点击发送，等待所有RAG技术完成回答（通常10-30秒）。

---

## 步骤4: 批量评估（右侧面板）

在右侧"🤖 自动评估"区域：

1. 点击 **「🚀 批量评估所有RAG技术」** 按钮

2. 观察进度条：
   ```
   正在评估 1/5: Simple RAG
   正在评估 2/5: Reranker RAG
   ...
   ✅ 评估完成！
   ```

3. 等待评估完成（约30秒-2分钟）

---

## 步骤5: 查看统计对比（右侧面板底部）

评估完成后，页面自动滚动到"📈 统计对比"区域。

### 5.1 详细对比表

查看所有RAG技术的全量指标：

| RAG技术 | 执行时间 | 相关性 | 忠实度 | 连贯性 | 流畅度 | 简洁性 | 综合得分 | Ragas-Faith | Ragas-Rel |
|---------|----------|--------|--------|--------|--------|--------|----------|-------------|-----------|
| Simple RAG | 2.35s | 8.5 | 9.0 | 8.0 | 8.5 | 7.5 | **8.3** | 0.845 | 0.923 |
| Reranker RAG | 3.12s | 9.0 | 8.5 | 8.5 | 8.0 | 8.0 | **8.4** | 0.891 | 0.947 |
| Fusion RAG | 4.21s | 8.8 | 9.2 | 8.2 | 8.3 | 7.8 | **8.5** | 0.912 | 0.935 |
| HyDE RAG | 3.45s | 9.2 | 8.8 | 8.8 | 8.5 | 8.2 | **8.7** | 0.876 | 0.951 |
| Query Trans | 2.89s | 9.5 | 9.0 | 9.0 | 8.8 | 8.5 | **8.9** | 0.895 | 0.965 |

### 5.2 可视化对比

切换到三个标签页：

#### **Tab 1: LLM评分对比**
- 柱状图展示6个维度的对比
- 显示最优技术：
  ```
  🏆 综合得分最高: Query Transformation (8.9/10)
  ```

#### **Tab 2: Ragas对比**
- 柱状图展示Faithfulness和Answer Relevancy
- 显示最优技术：
  ```
  🎯 Faithfulness最高: Fusion RAG (0.912)
  ```

#### **Tab 3: 性能对比**
- 左侧：执行时间对比
  ```
  ⚡ 最快: Simple RAG (2.35秒)
  ```
- 右侧：检索质量对比
  ```
  🎯 最优: Fusion RAG (0.89)
  ```

### 5.3 智能推荐

查看"💡 推荐"部分：

```
综合评分Top 3:
🥇 Query Transformation - 得分: 8.9/10, 耗时: 2.89秒
🥈 HyDE RAG - 得分: 8.7/10, 耗时: 3.45秒
🥉 Fusion RAG - 得分: 8.5/10, 耗时: 4.21秒
```

---

## 步骤6: 查看详细评估（右侧面板顶部）

切换标签页，查看每个RAG技术的详细结果：

### 示例：Query Transformation 标签

**📝 答案**
```
RAG（Retrieval Augmented Generation）技术是一种...
```

**⏱️ 执行时间**: 2.89秒  
**🎯 综合得分**: 8.9/10

**🔍 检索到的文档 (5个)**  
点击展开查看检索到的文档片段和相似度分数

**📊 详细评估结果**  
点击展开查看：
- **LLM评分 (0-10)**
  - 相关性: 9.5
  - 忠实度: 9.0
  - 连贯性: 9.0
  - 流畅度: 8.8
  - 简洁性: 8.5
  - 综合: 8.9
  
  💡 反馈: "答案准确回答了问题，信息来源于检索内容，逻辑清晰，表达流畅。"

- **Ragas评估 (0-1)**
  - Faithfulness: 0.895
  - Answer Relevancy: 0.965

---

## 💡 使用技巧

### 技巧1: 快速对比3-4个RAG
如果只想快速测试，选择3-4个常用RAG技术：
```
☑️ Simple RAG
☑️ Reranker RAG
☑️ Fusion RAG
☑️ Query Transformation
```

### 技巧2: 完整对比所有8个RAG
如果要做深度分析，选择所有8个：
```
☑️ Simple RAG
☑️ Reranker RAG
☑️ Fusion RAG
☑️ HyDE RAG
☑️ Contextual Compression
☑️ Query Transformation
☑️ Adaptive RAG
☑️ Self RAG
```

### 技巧3: 不同类型问题的最佳RAG

**简单事实问题**: 
- 推荐：Simple RAG、Reranker RAG（快速准确）

**复杂概念问题**: 
- 推荐：Query Transformation、HyDE RAG（语义理解更好）

**多跳推理问题**: 
- 推荐：Adaptive RAG、Self RAG（智能路由和质量控制）

**混合信息问题**: 
- 推荐：Fusion RAG（结合向量和关键词检索）

### 技巧4: 评估结果导出（未来功能）
目前评估结果保存在数据库中，可通过API查询：
```bash
GET /api/v1/evaluation/qa/{qa_record_id}
```

---

## 🎯 实战案例

### 案例1: 为生产环境选择最佳RAG

**场景**: 公司要部署一个客服知识库，需要选择最佳RAG方案。

**操作**:
1. 准备10个典型客户问题
2. 上传公司知识库文档
3. 选择所有8个RAG技术
4. 对每个问题进行批量评估
5. 统计各RAG的平均得分和平均响应时间
6. 根据"综合得分/响应时间"比值选择最佳方案

**结果示例**:
- 如果追求速度：选择 **Simple RAG** (综合得分7.8, 响应1.8秒)
- 如果追求质量：选择 **Query Transformation** (综合得分8.9, 响应2.9秒)
- 平衡方案：选择 **Reranker RAG** (综合得分8.4, 响应2.5秒)

### 案例2: A/B测试两个RAG技术

**场景**: 想对比Simple RAG和Reranker RAG的实际效果。

**操作**:
1. 只选择这两个RAG技术
2. 准备20个测试问题
3. 批量评估所有问题
4. 对比两者在各维度的平均得分
5. 分析哪些类型的问题Reranker RAG表现更好

---

## 🔧 常见问题

### Q1: 评估很慢怎么办？
**A**: 
- 不勾选"使用Ragas评估"，只用LLM评估
- 减少选择的RAG技术数量
- 检查网络连接和API配额

### Q2: 评估失败怎么办？
**A**: 
- 检查后端日志：`logs/backend.log`
- 确认LLM API key配置正确
- 尝试重新评估单个失败的RAG

### Q3: 如何导出评估结果？
**A**: 
- 当前版本可截图或复制表格
- 后续版本将支持CSV/Excel导出
- 可通过API查询数据库中的评估记录

### Q4: 评估结果不合理？
**A**: 
- LLM评估有主观性，可多次评估取平均
- 检查检索到的文档是否相关
- 调整RAG参数（top_k、chunk_size）重新测试

### Q5: 能否自定义评估维度？
**A**: 
- 当前版本维度固定（相关性、忠实度等）
- 后续版本将支持自定义评估模板
- 可修改 `backend/core/auto_evaluator.py` 自定义

---

## 📚 相关文档

- 📖 [完整更新说明](BATCH_AUTO_EVAL_UPDATE.md)
- 🤖 [自动评估指南](AUTO_EVALUATION_GUIDE.md)
- 📝 [项目README](README.md)

---

## 🎉 总结

通过批量自动评估功能，您可以：

1. ⚡ **快速对比**: 一键评估所有RAG技术，省时省力
2. 📊 **量化分析**: 多维度评分 + 可视化图表，直观对比
3. 💡 **智能推荐**: 自动推荐最佳RAG方案
4. 🎯 **科学决策**: 用数据驱动RAG技术选型

**现在就开始体验吧！** 🚀

